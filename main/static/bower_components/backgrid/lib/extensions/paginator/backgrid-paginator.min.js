/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
(function(e,t,a,s){"use strict";s.Extension.Paginator=a.View.extend({className:"backgrid-paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:t.template('<ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul>'),events:{"click a":"changePage"},initialize:function(e){s.requireOptions(e,["collection"]);var t=this.collection,a=t.fullCollection;a?(this.listenTo(a,"add",this.render),this.listenTo(a,"remove",this.render),this.listenTo(a,"reset",this.render)):(this.listenTo(t,"add",this.render),this.listenTo(t,"remove",this.render),this.listenTo(t,"reset",this.render))},changePage:function(t){t.preventDefault();var a=e(t.target).parent();if(!a.hasClass("active")&&!a.hasClass("disabled")){var s=e(t.target).text(),i=this.fastForwardHandleLabels,l=this.collection;if(i)switch(s){case i.first:return l.getFirstPage(),void 0;case i.prev:return l.getPreviousPage(),void 0;case i.next:return l.getNextPage(),void 0;case i.last:return l.getLastPage(),void 0}var n=l.state,r=+s;l.getPage(n.firstPage===0?r-1:r)}},makeHandles:function(){var e=[],t=this.collection,a=t.state,s=a.firstPage,i=+a.lastPage;i=Math.max(0,s?i-1:i);var l=Math.max(a.currentPage,a.firstPage);l=s?l-1:l;var n=Math.floor(l/this.windowSize)*this.windowSize,r=Math.min(i+1,n+this.windowSize);if(t.mode!=="infinite")for(var d=n;r>d;d++)e.push({label:d+1,title:"No. "+(d+1),className:l===d?"active":void 0});var h=this.fastForwardHandleLabels;return h&&(h.prev&&e.unshift({label:h.prev,className:t.hasPrevious()?void 0:"disabled"}),h.first&&e.unshift({label:h.first,className:t.hasPrevious()?void 0:"disabled"}),h.next&&e.push({label:h.next,className:t.hasNext()?void 0:"disabled"}),h.last&&e.push({label:h.last,className:t.hasNext()?void 0:"disabled"})),e},render:function(){return this.$el.empty(),this.$el.append(this.template({handles:this.makeHandles()})),this.delegateEvents(),this}})})(jQuery,_,Backbone,Backgrid);